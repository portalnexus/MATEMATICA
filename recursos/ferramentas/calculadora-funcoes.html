<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Fun√ß√µes | Nexus</title>

    <!-- KaTeX para renderiza√ß√£o LaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 1000px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #2563eb;
            margin-bottom: 10px;
            font-size: 2rem;
        }

        .subtitle {
            text-align: center;
            color: #64748b;
            margin-bottom: 30px;
            font-size: 0.95rem;
        }

        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-field {
            display: flex;
            flex-direction: column;
        }

        .input-field label {
            font-weight: 600;
            color: #334155;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .input-field input, .input-field select {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .input-field input:focus, .input-field select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .btn-calcular {
            width: 100%;
            padding: 15px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 30px;
        }

        .btn-calcular:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3);
        }

        .resultado {
            background: #f1f5f9;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            display: none;
        }

        .resultado h2 {
            color: #2563eb;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .resultado-item {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 8px;
            font-size: 1rem;
        }

        .resultado-item strong {
            color: #1e293b;
        }

        .graph-container {
            margin-top: 20px;
        }

        canvas {
            width: 100%;
            height: 400px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
        }

        .funcao-presets {
            margin-top: 20px;
        }

        .preset-btn {
            display: inline-block;
            padding: 8px 15px;
            margin: 5px;
            background: #e2e8f0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .preset-btn:hover {
            background: #cbd5e1;
        }

        @media (max-width: 640px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.5rem;
            }

            canvas {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßÆ Calculadora de Fun√ß√µes</h1>
        <p class="subtitle">Insira uma fun√ß√£o matem√°tica e visualize seu gr√°fico</p>

        <div class="input-group">
            <div class="input-field">
                <label for="funcao">Fun√ß√£o f(x):</label>
                <input type="text" id="funcao" value="x**2" placeholder="Ex: x**2, sin(x), log(x), sqrt(x)">
            </div>
            <div class="input-field">
                <label for="xMin">Intervalo (x):</label>
                <div style="display: flex; gap: 10px;">
                    <input type="number" id="xMin" value="-5" placeholder="M√≠nimo">
                    <input type="number" id="xMax" value="5" placeholder="M√°ximo">
                </div>
            </div>
        </div>

        <div class="funcao-presets">
            <strong>Fun√ß√µes predefinidas:</strong>
            <button class="preset-btn" onclick="carregarFuncao('x**2')">f(x) = x¬≤</button>
            <button class="preset-btn" onclick="carregarFuncao('x**3')">f(x) = x¬≥</button>
            <button class="preset-btn" onclick="carregarFuncao('sin(x)')">f(x) = sen(x)</button>
            <button class="preset-btn" onclick="carregarFuncao('cos(x)')">f(x) = cos(x)</button>
            <button class="preset-btn" onclick="carregarFuncao('exp(x)')">f(x) = eÀ£</button>
            <button class="preset-btn" onclick="carregarFuncao('log(abs(x))')">f(x) = ln|x|</button>
            <button class="preset-btn" onclick="carregarFuncao('abs(x)')">f(x) = |x|</button>
        </div>

        <button class="btn-calcular" onclick="calcular()">Calcular e Plotar</button>

        <div class="resultado" id="resultado">
            <h2>üìä An√°lise da Fun√ß√£o</h2>
            <div id="resultado-conteudo"></div>
        </div>

        <div class="graph-container">
            <canvas id="grafico"></canvas>
        </div>
    </div>

    <script>
        function carregarFuncao(funcao) {
            document.getElementById('funcao').value = funcao;
            calcular();
        }

        function calcular() {
            // Obter fun√ß√µes e intervalos
            const funcaoStr = document.getElementById('funcao').value;
            const xMin = parseFloat(document.getElementById('xMin').value) || -5;
            const xMax = parseFloat(document.getElementById('xMax').value) || 5;

            if (xMin >= xMax) {
                alert('O valor m√≠nimo deve ser menor que o valor m√°ximo!');
                return;
            }

            // Validar a fun√ß√£o
            try {
                // Testar se a fun√ß√£o √© v√°lida
                new Function('x', `return ${funcaoStr}`)(0);
            } catch (e) {
                alert('Fun√ß√£o inv√°lida! Verifique a sintaxe.');
                return;
            }

            // Avaliar fun√ß√£o de forma segura
            const avaliarFuncao = (x) => {
                try {
                    return eval(funcaoStr.replace(/x/g, `(${x})`)
                                        .replace(/sin/g, 'Math.sin')
                                        .replace(/cos/g, 'Math.cos')
                                        .replace(/tan/g, 'Math.tan')
                                        .replace(/exp/g, 'Math.exp')
                                        .replace(/log/g, 'Math.log')
                                        .replace(/sqrt/g, 'Math.sqrt')
                                        .replace(/abs/g, 'Math.abs')
                                        .replace(/\^/g, '**'));
                } catch (e) {
                    return NaN; // Retorna NaN para dom√≠nios inv√°lidos
                }
            };

            // Calcular alguns valores representativos para an√°lise
            const valoresTeste = [];
            const passo = (xMax - xMin) / 10;
            for (let i = 0; i <= 10; i++) {
                const x = xMin + i * passo;
                const y = avaliarFuncao(x);
                valoresTeste.push({x: x, y: y});
            }

            // Determinar dom√≠nio e imagem aproximados
            const valoresValidos = valoresTeste.filter(v => !isNaN(v.y) && isFinite(v.y));
            let yMin = Infinity, yMax = -Infinity;
            if (valoresValidos.length > 0) {
                yMin = Math.min(...valoresValidos.map(v => v.y));
                yMax = Math.max(...valoresValidos.map(v => v.y));
            } else {
                yMin = -10;
                yMax = 10;
            }

            // Expandir um pouco os limites
            const yRange = yMax - yMin;
            if (yRange === 0) yRange = 10;
            yMin -= yRange * 0.1;
            yMax += yRange * 0.1;

            // Exibir resultados
            const resultadoDiv = document.getElementById('resultado');
            const conteudoDiv = document.getElementById('resultado-conteudo');

            conteudoDiv.innerHTML = `
                <div class="resultado-item"><strong>Fun√ß√£o:</strong> f(x) = ${funcaoStr}</div>
                <div class="resultado-item"><strong>Dom√≠nio (aprox.):</strong> [${xMin.toFixed(2)}, ${xMax.toFixed(2)}]</div>
                <div class="resultado-item"><strong>Imagem (aprox.):</strong> [${yMin.toFixed(2)}, ${yMax.toFixed(2)}]</div>
                <div class="resultado-item"><strong>Exemplo em x=0:</strong> f(0) = ${avaliarFuncao(0).toFixed(4)}</div>
                <div class="resultado-item"><strong>Exemplo em x=1:</strong> f(1) = ${avaliarFuncao(1).toFixed(4)}</div>
            `;

            resultadoDiv.style.display = 'block';

            // Desenhar gr√°fico
            desenharGrafico(avaliarFuncao, xMin, xMax, yMin, yMax);
        }

        function desenharGrafico(funcao, xMin, xMax, yMin, yMax) {
            const canvas = document.getElementById('grafico');
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = canvas.offsetHeight;

            // Limpar canvas
            ctx.clearRect(0, 0, width, height);

            // Configurar sistema de coordenadas
            const margin = 50;
            const plotWidth = width - 2 * margin;
            const plotHeight = height - 2 * margin;

            // Fun√ß√µes de transforma√ß√£o
            const toCanvasX = (x) => margin + ((x - xMin) / (xMax - xMin)) * plotWidth;
            const toCanvasY = (y) => height - margin - ((y - yMin) / (yMax - yMin)) * plotHeight;

            // Desenhar eixos
            ctx.strokeStyle = '#1f2937';
            ctx.lineWidth = 2;

            // Eixo X
            ctx.beginPath();
            ctx.moveTo(margin, toCanvasY(0));
            ctx.lineTo(width - margin, toCanvasY(0));
            ctx.stroke();

            // Eixo Y
            ctx.beginPath();
            ctx.moveTo(toCanvasX(0), margin);
            ctx.lineTo(toCanvasX(0), height - margin);
            ctx.stroke();

            // Desenhar grid
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;

            // Linhas verticais do grid
            const xStep = (xMax - xMin) / 10;
            for (let x = xMin; x <= xMax; x += xStep) {
                ctx.beginPath();
                ctx.moveTo(toCanvasX(x), margin);
                ctx.lineTo(toCanvasX(x), height - margin);
                ctx.stroke();
            }

            // Linhas horizontais do grid
            const yStep = (yMax - yMin) / 10;
            for (let y = yMin; y <= yMax; y += yStep) {
                ctx.beginPath();
                ctx.moveTo(margin, toCanvasY(y));
                ctx.lineTo(width - margin, toCanvasY(y));
                ctx.stroke();
            }

            // Desenhar fun√ß√£o
            ctx.strokeStyle = '#2563eb';
            ctx.lineWidth = 3;
            ctx.beginPath();

            // Ajustar n√∫mero de pontos para qualidade
            const numPontos = Math.min(1000, plotWidth * 2);
            const xStepPlot = (xMax - xMin) / numPontos;

            let primeiro = true;  // Para come√ßar um novo caminho
            for (let i = 0; i <= numPontos; i++) {
                const x = xMin + i * xStepPlot;
                const y = funcao(x);

                if (!isNaN(y) && isFinite(y)) {
                    const canvasX = toCanvasX(x);
                    const canvasY = toCanvasY(y);

                    if (primeiro) {
                        ctx.moveTo(canvasX, canvasY);
                        primeiro = false;
                    } else {
                        ctx.lineTo(canvasX, canvasY);
                    }
                } else {
                    primeiro = true;  // Reiniciar o caminho para evitar linhas erradas
                }
            }
            ctx.stroke();

            // Desenhar r√≥tulos dos eixos
            ctx.fillStyle = '#1e293b';
            ctx.font = 'bold 12px sans-serif';
            ctx.textAlign = 'center';
            
            // R√≥tulos no eixo X
            for (let x = xMin; x <= xMax; x += (xMax - xMin) / 5) {
                ctx.fillText(x.toFixed(1), toCanvasX(x), height - margin + 20);
            }

            // R√≥tulos no eixo Y
            ctx.textAlign = 'right';
            for (let y = yMin; y <= yMax; y += (yMax - yMin) / 5) {
                ctx.fillText(y.toFixed(1), margin - 10, toCanvasY(y) + 4);
            }

            // T√≠tulo dos eixos
            ctx.textAlign = 'center';
            ctx.fillText('x', width / 2, height - 10);
            ctx.save();
            ctx.translate(15, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('f(x)', 0, 0);
            ctx.restore();
        }

        // Calcular automaticamente ao carregar
        window.onload = calcular;

        // Recalcular ao pressionar Enter
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') calcular();
            });
        });
    </script>
</body>
</html>